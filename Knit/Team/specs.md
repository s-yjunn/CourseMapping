# Specifications for Knitty Gritty
#### _In the MVC framework._
The site's data is divided into __Public__ and __Private__ regions.

* Forum and contest data is __Public__  
    * Forum  
        * Model: A single array of objects stored in “Public/data/forum.json”. Each object represents a post, with _title_, _author_, _content_ (post body text), _score_, _posted_ (unix timestamp of initial creation), _active_ (timestamp of most recent activity), and _responses_ attributes. _responses_ is an array of objects representing responses to the post, which have _author_, _content_, _score_ and _posted_ attributes.  
        * View: All visitors can view these items in the "Forum" tab. The home page shows a table of all posts with their ranking, number of responses, title, author, and timestamp of last activity formatted as "a year ago, 2 seconds ago, etc." There is also a refresh button which checks for updates. Visitors get a similar table when they use the forum search bar, which looks for posts whose titles or contents contain the search query. Visitors can sort both tables by various methods: the main index can be sorted by _active_ (default), _highest ranked_, or _unanswered_ (posts with no responses on top, for super helpful people). They can click on the title of a post in either table to view it and responses to it. Once in a post they can sort its responses by _highest ranked_ (default) or _oldest first_.   
        * Controller: Registered and logged in users can modify the json array by:  
            * Adding posts to the forum (which creates a new object in the forum json)  
            * Adding responses to a post (creates a new object in that post’s _responses_ array)  
            * Upvoting or downvoting posts or responses (adding to or subtracting from their _score_ attributes)  
            * Deleting a post or response -- for regular users, one that they authored, for admins, any (removes that object from the forum json)  

    * Contest
        * Model: Image files are stored in "Public/imgs/contest/", and an object in "Public/data/contest.json". Each contest entry has an object with fields _author_ (user name of submitter), _image_ (name of image file of knitted item), _text_ (instructions to make the knitted item), and _score_ (starts at 0, raised by voting). These objects live in one of three arrays within the main contest object: _submissions_, _contestants_, or _winners_.
        * View: The _winners_ images are displayed on the home page of the "Featured" slideshow. All accepted _contestants_' image, title and author are displayed in the "Vote" section of the "Contest" tab. By clicking on the featured image or "View" button in the contest tab, all visitors can see the full pattern, including image, title, author and instructions. Admins can see the full pattern for all _submissions_ and _contestants_ by clicking on their names in the "Manage site -> Contest" page.
        * Controller: When a user submits an image and txt file to the contest, their image is added to the "contest" folder, and a new object of the type described above is initialized and added to the "submissions" array in the main contest object. Then, if approved by the site administrator (still buggy), the submission is moved into the "contestants" array. The admin can also delete it (still buggy). Finally, after voting on the "contestants" is complete, admin can preview their choice of # of winners (still buggy), and end the competition by moving the top contestants into the "winners" array, while the other contestant entries are deleted.

* All data related to registered users, including admins, is __Private__
    * User credentials and profile information
        * Model: An object stored in “Private/users.json”. The unique username of each registered user is a key that corresponds to an object containing a _psw_ (password), _registered_ (registration timestamp) _admin_ (boolean indicating whether the user has admin privileges), _pfp_ (the file name of their profile picture, or null if they haven't entered one), _about_ (their public-facing description, initialized as "This user hasn't entered a bio."), and _patterns_ (more on this later). If the user has uploaded a profile picture, it is stored in "Private/<username>".
        * View: Users interact with the credentials when they log in to the site. The public information about each user (_username_, _admin_, _about_, and any public _patterns_) is visible to anyone who clicks on their username in any posts of responses they’re made in the forum. Users can also see their own profile in the “Profile” section of the “My account” tab. Admins can see this as well as the user's account creation date and total number of patterns (public and private) in the "manage site" tab.
        * Controller: Visitors add a new entry to the users.json object when they create a new account. Registered users can modify their _pfp_ and _about_ attributes in the"profile" section of the "my account" tab. Patterns are managed in the "patterns" section of the my account tab. See below.

    * User-created grid patterns
        * Model: Png files in the user's "Private/<username>/patterns" folder, and the _patterns_ array of each user's users.json object. Each pattern object contains the attributes _image_ (filename) and _public_ (boolean indicating if the pattern should be displayed on the user's profile, initialized as false).
        * View: The public patterns of each user are visible on their public profile, which are visible to all site visitors if the user has posted in the forum. The user can also see all of their saved patterns in the "Patterns" section of the "My account" tab.
        * Controller: The user creates a new pattern image/object by pressing the "Save to my account" button under the "Pattern maker" grid. They can then view it in their "Patterns" section in the "My account" tab, where they can click on it to change its visibility to public, or back to private, or delete it.

    * User inboxes (messages from site admin)
        * Model: An object in the "messages.json" file housed in each user's "Private/<username>" folder. The object contains two arrays, one keyed to _unread_ and one to _read_. Each of those arrays contains an object for each read or unread message the user has received, which has _text_ (message content), _from_ (the sender of the message) and _sent_ (timestamp of message) attributes.
        * View: The user can see their messages in the "Inbox" section of the "My account" tab. They are divided into unread and read sections. They can use the refresh button (no page reloading) to check for new messages.
        * Controller: When a new user makes an account, a new message file is created for them, and a welcome message from "THE MANAGEMENT" is added to the _unread_ array. Each time the user opens or refreshes their inbox, any unread messages are moved into the _read_ array after being collected for display. Site administrators can add to any user's _unread_ messages array by sending them a message through the "Users" section of the "Manage site" tab.

    * Admin inbox (messages from site visitors)
        * Model: An object in the "Private/adminMessages.json" file. This object is structured identically to the user inbox objects (_unread_, _read_, same attributes on messages)
        * View: The main "view" difference between this inbox and a regular user inbox (which admin users also have) is that all admins share one inbox. They can view their messages (formatted identically to those in the regular user inbox) in the "Inbox" section of the "Manage site" tab, and check for new messages with the refresh button.
        * Controller: Any visitor to the site can add to the admin _unread_ array by sending them a message from the "help" popup accessed from the site footer. Registered users can also send messages to admin from their inbox.